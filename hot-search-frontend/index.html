<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çƒ­ç‚¹ä¸€è§ˆ</title>
    <link rel="icon" href="./icon/favicon.png">
    <link rel="stylesheet" href="index.css">

    <!-- å¼•å…¥element-uiæ ·å¼ -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <!-- å¼•å…¥element-uiç»„ä»¶åº“ -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <!-- å¼•å…¥axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- å¼•å…¥ Vue -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>

</head>

<body>
<!-- åˆ›å»ºä¸€ä¸ªæ ¹å…ƒç´  -->
<div class="home" id="home">
    <header>
        <div class="time-display">
            <span id="beijing-time"></span>
            <span id="week-day"></span>
        </div>
        <!--åˆ‡æ¢ä¸»é¢˜-->
        <button id="theme-toggle" class="theme-toggle">
            <span id="theme-icon" @click="toggleTheme">ğŸŒ</span> <!-- é»˜è®¤æ˜¾ç¤ºå¤ªé˜³å›¾æ ‡ -->
        </button>
    </header>

    <div class="container">
        <div class="list-wrapper">
            <div class="hot-list-card" v-for="(platform, index) in platforms" :key="index">
                <div class="list-header">
                    <div class="logo" :class="platform.logoClass"></div>
                    <span class="list-title">{{ platform.name }}</span>
                </div>
                <div class="list-content">
                    <div v-if="platform.isLoading" class="loading">
                        æ•°æ®åŠ è½½ä¸­...
                    </div>
                    <div v-else-if="platform.error" class="error">
                        æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•ã€‚
                    </div>
                    <div v-else>
                        <div class="list-item" v-for="(item, itemIndex) in platform.hotList" :key="itemIndex">
                            <span class="rank">{{ item.hotRank }}</span>
                            <a :href="item.hotUrl" target="_blank" class="item-title" :title="item.hotTitle">
                                {{ item.hotTitle.length > 30 ? item.hotTitle.substring(0, 30) + '...' : item.hotTitle }}
                            </a>
                            <span class="score">{{ formatHotValue(item.hotValue) }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    window.onload = function () {
        vm.init();
        updateTime();
        setInterval(updateTime, 1000);
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æœ¬åœ°å­˜å‚¨çš„ä¸»é¢˜è®¾ç½®
        checkLocalStorageTheme();
    }

    function updateTime() {
        const now = new Date();
        const beijingTime = now.toLocaleString('zh-CN', {timeZone: 'Asia/Shanghai'});
        document.getElementById('beijing-time').textContent = `${beijingTime}`;

        const weekDay = now.toLocaleString('zh-CN', {weekday: 'long'});
        document.getElementById('week-day').textContent = `${weekDay}`;
    }

    function checkLocalStorageTheme() {
        const savedTheme = localStorage.getItem('appTheme');
        if (savedTheme === 'dark') {
            document.body.classList.add('dark-theme');
            document.getElementById('theme-icon').textContent = 'ğŸŒ™';
        }
    }

    // å°†vueæŒ‚è½½åˆ°idä¸ºhomeçš„æ ¹å…ƒç´ ä¸Š
    const vm = new Vue({
        el: '#home',
        data: {
            platforms: [
                {name: 'ç™¾åº¦çƒ­æ¦œ', logoClass: 'baidu-logo', hotList: [], type: 'baidu', isLoading: true, error: false},
                {
                    name: 'æŠ–éŸ³çƒ­æ¦œ',
                    logoClass: 'douyin-logo',
                    hotList: [],
                    type: 'douyin',
                    isLoading: true,
                    error: false
                },
                {name: 'çŸ¥ä¹çƒ­æ¦œ', logoClass: 'zhihu-logo', hotList: [], type: 'zhihu', isLoading: true, error: false},
                {
                    name: 'Bç«™çƒ­æ¦œ',
                    logoClass: 'bilibili-logo',
                    hotList: [],
                    type: 'bilibili',
                    isLoading: true,
                    error: false
                },
                {
                    name: 'æ˜é‡‘çƒ­æ¦œ',
                    logoClass: 'juejin-logo',
                    hotList: [],
                    type: 'juejin',
                    isLoading: true,
                    error: false
                },
                {
                    name: 'è…¾è®¯ç½‘çƒ­æ¦œ',
                    logoClass: 'tengxunwang-logo',
                    hotList: [],
                    type: 'tengxunwang',
                    isLoading: true,
                    error: false
                },
                {name: 'è´´å§çƒ­æ¦œ', logoClass: 'tieba-logo', hotList: [], type: 'tieba', isLoading: true, error: false},
                {
                    name: 'å¤´æ¡çƒ­æ¦œ',
                    logoClass: 'toutiao-logo',
                    hotList: [],
                    type: 'toutiao',
                    isLoading: true,
                    error: false
                }
            ]
        },
        methods: {
            // åˆå§‹åŒ–å‡½æ•°
            init() {
                this.platforms.forEach(platform => {
                    this.loadPlatformData(platform);
                });
            },

            // è·å–çƒ­æ¦œæ•°æ®
            loadPlatformData(platform) {
                const self = this;
                axios.get(`http://117.72.117.19:9782/hotSearch/queryByType/${platform.type}`)
                    .then(response => {
                        platform.hotList = response.data.data;
                        platform.isLoading = false;
                        platform.error = false;
                        console.log(`${platform.name} æ•°æ®:`, response.data.data);
                    })
                    .catch(error => {
                        platform.isLoading = false;
                        platform.error = true;
                        console.error(`è·å–${platform.name}æ•°æ®å¤±è´¥`, error);
                    });
            },

            // æ ¼å¼åŒ–çƒ­æ¦œå€¼
            formatHotValue(value) {
                if (value > 10000) {
                    return (value / 10000).toFixed(1) + 'ä¸‡';
                }
                return value;
            },

            // åˆ‡æ¢ä¸»é¢˜
            toggleTheme() {
                const body = document.body;
                const themeIcon = document.getElementById('theme-icon');

                if (body.classList.contains('dark-theme')) {
                    body.classList.remove('dark-theme');
                    themeIcon.textContent = 'ğŸŒ'; // åˆ‡æ¢åˆ°å¤ªé˜³å›¾æ ‡
                    // ä¿å­˜ä¸»é¢˜è®¾ç½®åˆ°æœ¬åœ°å­˜å‚¨
                    localStorage.setItem('appTheme', 'light');
                } else {
                    body.classList.add('dark-theme');
                    themeIcon.textContent = 'ğŸŒ™'; // åˆ‡æ¢åˆ°æœˆäº®å›¾æ ‡
                    // ä¿å­˜ä¸»é¢˜è®¾ç½®åˆ°æœ¬åœ°å­˜å‚¨
                    localStorage.setItem('appTheme', 'dark');
                }
            },
        }
    });
</script>
</body>
</html>